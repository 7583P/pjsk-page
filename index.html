<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PJSK LOUNGE</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #383838;
      color: #ffffff;
    }
    #app {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #2a2a2a;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #555;
      vertical-align: middle;
    }
    th {
      background-color: #030050 !important;
      color: #fff;
    }
    tbody tr:nth-child(odd)  { background-color: #333; }
    tbody tr:nth-child(even) { background-color: #2a2a2a; }

    .flag {
      width: 24px;
    }

    /* flex para posición + bandera */
    .pos-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    /* texto degradado */
    .text-gradient {
      display: inline-block;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    /* override para emojis: color sólido */
    .emoji-char {
      display: inline-block;
      color: #fff !important;
      background: none !important;
      -webkit-text-fill-color: initial !important;
    }

    /* degradados por rango */
    .rank-Placement .text-gradient {
      background-image: linear-gradient(to right, #ff7000, #ff4600);
    }
    .rank-Bronze .text-gradient {
      background-image: linear-gradient(to right, #6d2a00, #3d1d00);
    }
    .rank-Gold .text-gradient {
      background-image: linear-gradient(to right, #ffbf60, #c57600);
    }
    .rank-Diamond .text-gradient {
      background-image: linear-gradient(to right, #2797ff, #0063e4);
    }

    /* resto de tu CSS… */
  </style>
</head>
<body>
  <div id="app">
    <h1>PJSK LOUNGE – Temporada {{ seasonLabel }}</h1>
    <div class="controls">
      <input type="text" v-model="filter" placeholder="Buscar por nombre…">
    </div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Player</th>
          <th>MMR</th>
          <th>Rango</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="p in paginatedPlayers" :key="p.id" :class="rankClass(p.rank)">
          <!-- POSICIÓN -->
          <td>
            <div class="pos-content">
              <span class="text-gradient">{{ playerRankMap[p.id] }}</span>
              <img v-if="p.country"
                   :src="flagUrl(p.country)"
                   :alt="p.country"
                   class="flag"/>
            </div>
          </td>

          <!-- NOMBRE: iteramos cada carácter -->
          <td>
            <template v-for="(ch, idx) in [...p.name]" :key="idx">
              <span
                :class="isEmoji(ch) ? 'emoji-char' : 'text-gradient'">
                {{ ch }}
              </span>
            </template>
          </td>

          <!-- MMR -->
          <td>
            <span class="text-gradient">{{ p.mmr }}</span>
          </td>

          <!-- RANGO -->
          <td>
            <span class="text-gradient">{{ p.rank }}</span>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- PAGINACIÓN… -->
  </div>

  <script src="https://unpkg.com/vue@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          players: [], filter: '',
          playerRankMap: {},
          currentPage: 1, pageSize: 50
        };
      },
      computed: {
        filteredPlayers() {
          const q = this.filter.toLowerCase();
          return this.players.filter(p => p.name.toLowerCase().includes(q));
        },
        totalPages() {
          return Math.max(1, Math.ceil(this.filteredPlayers.length / this.pageSize));
        },
        paginatedPlayers() {
          const start = (this.currentPage - 1) * this.pageSize;
          return this.filteredPlayers.slice(start, start + this.pageSize);
        },
        seasonLabel() {
          const start = new Date(2025,4,16), now = new Date();
          const months = (now.getFullYear()-start.getFullYear())*12 + (now.getMonth()-start.getMonth());
          return Math.floor(months/3) === 0 ? 'Beta' : Math.floor(months/3);
        }
      },
      methods: {
        isEmoji(ch) {
          return /\p{Emoji}/u.test(ch);
        },
        flagUrl(cc) {
          return `https://flagcdn.com/24x18/${cc.toLowerCase()}.png`;
        },
        rankClass(rank) {
          return `rank-${rank}`;
        },
        async fetchPlayers() {
          try {
            const resp = await axios.get('https://worker-production-1ad2.up.railway.app/api/players');
            const sorted = resp.data.sort((a,b)=> b.mmr - a.mmr);
            this.players = sorted;
            const map = {}; sorted.forEach((p,i)=> map[p.id]=i+1);
            this.playerRankMap = map;
          } catch(e){ console.error(e); alert('Error cargando jugadores'); }
        },
        prevPage(){ if(this.currentPage>1) this.currentPage--; },
        nextPage(){ if(this.currentPage<this.totalPages) this.currentPage++; },
        goToPage(){}  // el watcher valida
      },
      mounted() {
        this.fetchPlayers();
        setInterval(this.fetchPlayers, 10000);
      }
    }).mount('#app');
  </script>
</body>
</html>


