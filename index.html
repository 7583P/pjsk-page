<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>PJSK LOUNGE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#383838; --panel:#2a2a2a; --panel2:#242424; --ink:#fff; --muted:#bfbfbf;
      --brand:#6c6cf0; --warn:#f0a66c; --ok:#58d68d; --err:#ff6b6b; --line:#0006;
      --row1:#333; --row2:#2a2a2a; --hover:#595959; --chip:#444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    /* Layout */
    header.topbar{
      background:var(--panel);
      border-bottom:1px solid var(--line);
      position:sticky;top:0;z-index:10;
    }
    .topwrap{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:16px}
    .brand{font-weight:700;letter-spacing:.5px}
    nav.tabs{display:flex;gap:8px;margin-left:16px}
    nav.tabs button{
      background:transparent;color:var(--ink);border:1px solid transparent;border-radius:8px;
      padding:8px 12px;cursor:pointer;font-weight:600
    }
    nav.tabs button.active, nav.tabs button:hover{background:var(--panel2);border-color:#0006}

    .spacer{flex:1}
    .userbox{display:flex;align-items:center;gap:10px}
    .userbox .discord-badge{
      display:flex;align-items:center;gap:6px;background:#5865F2; /* Discord brand */
      padding:6px 10px;border-radius:999px;font-weight:600
    }
    .userbox .discord-badge svg{width:16px;height:16px}
    .userbox .login-btn{
      background:#5865F2;border:none;color:white;border-radius:8px;padding:8px 12px;cursor:pointer;font-weight:700
    }
    .userbox .login-btn:hover{filter:brightness(1.07)}

    main{max-width:1100px;margin:18px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,.25)}
    .card .wrap{padding:18px}

    .title{margin:0 0 8px}
    .muted{color:var(--muted)}
    .divider{height:1px;background:var(--line);margin:14px 0}

    .primary{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .primary:hover{filter:brightness(1.05)}
    .ghost{background:transparent;border:1px solid #0006;color:var(--ink);border-radius:10px;padding:10px 14px;cursor:pointer}
    .ghost:hover{background:var(--hover)}

    .row{display:flex;gap:16px;flex-wrap:wrap}
    .half{flex:1 1 520px}

    .notice{
      background:#444;border:1px dashed #666;color:#fff;padding:12px;border-radius:10px
    }
    .ok{color:var(--ok)} .err{color:var(--err)}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topwrap">
      <div class="brand">PJSK LOUNGE</div>
      <nav class="tabs" id="tabs">
        <button data-tab="home" class="active">Home</button>
        <button data-tab="leaderboard">Leaderboard</button>
        <button data-tab="edit">Edit Profile</button>
      </nav>
      <div class="spacer"></div>
      <div class="userbox" id="userBox">
        <!-- Rellenado por JS -->
        <button class="login-btn" id="btnLogin" title="Vincular cuenta con Discord">
          <!-- Discord logo -->
          <svg viewBox="0 0 245 240" aria-hidden="true" fill="white">
            <path d="M104.4 104.9c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1zm36.2 0c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1z"/>
            <path d="M189.5 20h-134C24.3 20 10 34.3 10 51.5v137C10 205.7 24.3 220 41.5 220h113.3l-5.3-18.4 12.8 11.8 12.1 11.2 21.5 19.4V51.5C196 34.3 211.3 20 228.5 20h-39z"/>
          </svg>
          Vincular cuenta con Discord
        </button>
      </div>
    </div>
  </header>

  <main>
    <section id="home" class="card">
      <div class="wrap">
        <h1 class="title">Welcome to PJSK LOUNGE</h1>
        <p class="muted">New project of competitive pjsk with a DISCORD BOT and PAGE created for this project.</p>
        <div id="homeContent" style="margin-top:12px">
          <!-- Se completa vía JS -->
        </div>
      </div>
    </section>

    <div class="divider"></div>

    <section id="leaderboard" class="card" style="display:none">
      <div class="wrap">
        <h2 class="title">Leaderboard</h2>
        <p class="muted">Próximamente…</p>
      </div>
    </section>

    <div class="divider"></div>

    <section id="edit" class="card" style="display:none">
      <div class="wrap">
        <h2 class="title">Edit Profile (PFP)</h2>
        <div id="editGate">
          <!-- Si no está verificado, mostramos aviso -->
        </div>

        <div id="editPanel" style="display:none">
          <div class="notice" style="margin-bottom:12px">
            <strong class="ok">✔</strong> Estás verificado con Discord. Edit PFP habilitado.
          </div>
          <!-- Aquí coloca tu UI de selección de cartas PFP -->
          <div class="row">
            <div class="half">
              <h3 style="margin:6px 0">Set PFP</h3>
              <button class="ghost" id="btnSetPfp">Elegir carta…</button>
              <button class="ghost" id="btnClearPfp" style="margin-left:6px">Eliminar PFP</button>
              <p class="muted" style="margin-top:10px">Al elegir una carta, tu PFP se actualizará en tu perfil de PJSK LOUNGE (no cambia tu avatar en Discord).</p>
            </div>
            <div class="half">
              <h3 style="margin:6px 0">Vista previa</h3>
              <div id="pfpPreview" class="notice">Sin PFP seleccionado.</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ======= CONFIG =======
    // Si sirves frontend y backend en el mismo dominio, deja API_BASE = "".
    // Si están en dominios distintos, pon el origen de tu API, p.ej. "https://api.tudominio.com"
    const API_BASE = "";
    const ME_URL = API_BASE + "/api/auth/me";
    const LOGIN_URL = API_BASE + "/api/auth/login";

    // ======= UI helpers =======
    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    const tabsEl = qs("#tabs");
    const userBox = qs("#userBox");
    const btnLogin = qs("#btnLogin");
    const homeContent = qs("#homeContent");
    const editGate = qs("#editGate");
    const editPanel = qs("#editPanel");

    let currentUser = null;

    function setActiveTab(name){
      qsa("nav.tabs button").forEach(b=>{
        b.classList.toggle("active", b.dataset.tab===name);
      });
      qsa("main > section").forEach(s=>{
        s.style.display = (s.id===name) ? "" : "none";
      });
    }

    tabsEl.addEventListener("click", (e)=>{
      if(e.target.tagName==="BUTTON"){
        setActiveTab(e.target.dataset.tab);
      }
    });

    btnLogin.addEventListener("click", ()=>{
      // Redirige al backend para iniciar el flujo OAuth2 con Discord
      window.location.href = LOGIN_URL;
    });

    // Render del header (derecha)
    function renderUserBox(user){
      if(!user){
        userBox.innerHTML = `
          <button class="login-btn" id="btnLogin2" title="Vincular cuenta con Discord">
            <svg viewBox="0 0 245 240" aria-hidden="true" fill="white">
              <path d="M104.4 104.9c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1zm36.2 0c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1z"/>
              <path d="M189.5 20h-134C24.3 20 10 34.3 10 51.5v137C10 205.7 24.3 220 41.5 220h113.3l-5.3-18.4 12.8 11.8 12.1 11.2 21.5 19.4V51.5C196 34.3 211.3 20 228.5 20h-39z"/>
            </svg>
            Vincular cuenta con Discord
          </button>`;
        userBox.querySelector("#btnLogin2").addEventListener("click", ()=>window.location.href = LOGIN_URL);
      } else {
        const display = user.global_name || user.username;
        userBox.innerHTML = `
          <div class="discord-badge" title="Conectado con Discord">
            <svg viewBox="0 0 245 240" aria-hidden="true" fill="white">
              <path d="M104.4 104.9c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1zm36.2 0c-5.7 0-10.2 5-10.2 11.1 0 6.1 4.6 11.1 10.2 11.1 5.7 0 10.2-5 10.2-11.1 0-6.1-4.6-11.1-10.2-11.1z"/>
              <path d="M189.5 20h-134C24.3 20 10 34.3 10 51.5v137C10 205.7 24.3 220 41.5 220h113.3l-5.3-18.4 12.8 11.8 12.1 11.2 21.5 19.4V51.5C196 34.3 211.3 20 228.5 20h-39z"/>
            </svg>
            <span>${escapeHtml(display)}</span>
          </div>`;
      }
    }

    function renderHome(user){
      if(!user){
        homeContent.innerHTML = `
          <p class="muted">Para usar tu perfil, primero vincula tu cuenta.</p>
          <button class="primary" id="homeLogin">Vincular cuenta con Discord</button>
        `;
        qs("#homeLogin").addEventListener("click", ()=>window.location.href = LOGIN_URL);
      } else {
        const display = user.global_name || user.username;
        homeContent.innerHTML = `
          <p>Conectado como <strong>${escapeHtml(display)}</strong> <span class="muted">(Discord)</span>.</p>
          <div style="margin-top:8px">
            <button class="ghost" onclick="document.querySelector('button[data-tab=edit]').click()">Ir a Edit PFP</button>
          </div>
        `;
      }
    }

    function renderEdit(user){
      if(!user){
        editGate.innerHTML = `<div class="notice"><strong class="err">✖</strong> you must be verified on discord to edit pfp</div>`;
        editPanel.style.display = "none";
      } else {
        editGate.innerHTML = "";
        editPanel.style.display = "";
      }
    }

    // Seguridad básica para evitar XSS en contenido dinámico
    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[s]));
    }

    async function fetchMe(){
      try{
        const res = await fetch(ME_URL, { credentials:"include" });
        if(!res.ok) return null;
        return await res.json();
      }catch(_){ return null; }
    }

    async function init(){
      setActiveTab("home");
      currentUser = await fetchMe();
      renderUserBox(currentUser);
      renderHome(currentUser);
      renderEdit(currentUser);

      // Soporte para retorno desde /api/auth/callback
      if (location.hash === "#auth=ok") {
        history.replaceState({}, "", location.pathname);
      }
    }

    // PFP demo handlers (pon aquí tu lógica real de cartas)
    qs("#btnSetPfp").addEventListener("click", ()=>{
      qs("#pfpPreview").textContent = "PFP seleccionado (demo). Integra aquí tu selector de cartas.";
    });
    qs("#btnClearPfp").addEventListener("click", ()=>{
      qs("#pfpPreview").textContent = "Sin PFP seleccionado.";
    });

    init();
  </script>
</body>
</html>



